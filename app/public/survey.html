<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FriendFinder</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />

    <!-- Font Awesome Glyphicons -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"
    />

    <!-- Chosen -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Almendra+SC&family=MedievalSharp&display=swap"
      rel="stylesheet"
    />

    <style>
      html,
      body {
        background: url("./assets/images/parchment-bg.png") repeat;
        background-size: 600px auto;
        font-family: "MedievalSharp", cursive;
        color: #3b2e1c;
      }

      h2,
      h4,
      h5,
      label {
        color: #4a2e1a;
        font-family: "Almendra SC", serif;
      }

      p,
      .question-text {
        color: #5a3a1e;
      }
      b .form-control,
      .chosen-container-single .chosen-single {
        background-color: #fdf6e3 !important;
        color: #2c1f15 !important;
        border: 1px solid #6a4e34 !important;
      }

      .chosen-container .chosen-drop,
      .chosen-container .chosen-results li {
        background-color: #fdf6e3 !important;
        color: #2c1f15 !important;
      }

      .chosen-container .chosen-results li.highlighted {
        background-color: #800000 !important;
        color: white !important;
      }
      .chosen-container-single .chosen-single span {
        color: #2c1f15 !important;
      }

      .chosen-container-single .chosen-default {
        color: #6a4e34 !important;
      }

      .btn-westeros {
        background-color: #800000;
        border: none;
        color: white;
        font-family: "Almendra SC", serif;
        font-size: 1.2rem;
        border-radius: 8px;
        transition: background-color 0.3s ease;
      }

      .btn-westeros:hover {
        background-color: #a52a2a;
      }

      a {
        color: #a52a2a;
        font-weight: bold;
        transition: color 0.3s ease;
      }

      a:hover {
        color: #fff2d9;
        text-decoration: underline;
      }

      .footer {
        margin-top: 3rem;
        text-align: center;
        font-size: 0.95rem;
        color: #d6c3a5;
      }

      .toggle-container {
        position: fixed;
        top: 15px;
        right: 20px;
        z-index: 9999;
        font-size: 0.9rem;
        color: #fefefe;
        font-family: "Almendra SC", serif;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h4><a href="/">Home</a><br /></h4>
      <h2>Survey Questions</h2>
      <hr />

      <h4><strong>About You</strong></h4>
      <h5>Name (Required)</h5>
      <input type="text" id="name" class="form-control" required />

      <h5>Link to Photo Image (Required)</h5>
      <input type="text" id="photo" class="form-control" required />

      <hr />

      <h4><strong>Question 1</strong></h4>
      <h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
      <select class="chosen-select" id="q1">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 2</strong></h4>
      <h5>
        Generally speaking, you rely more on your experience than your
        imagination.
      </h5>
      <select class="chosen-select" id="q2">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 3</strong></h4>
      <h5>
        You find it easy to stay relaxed and focused even when there is some
        pressure.
      </h5>
      <select class="chosen-select" id="q3">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 4</strong></h4>
      <h5>You rarely do something just out of sheer curiosity.</h5>
      <select class="chosen-select" id="q4">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 5</strong></h4>
      <h5>People can rarely upset you.</h5>
      <select class="chosen-select" id="q5">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 6</strong></h4>
      <h5>
        It is often difficult for you to relate to other people’s feelings.
      </h5>
      <select class="chosen-select" id="q6">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 7</strong></h4>
      <h5>
        In a discussion, truth should be more important than people’s
        sensitivities.
      </h5>
      <select class="chosen-select" id="q7">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 8</strong></h4>
      <h5>You rarely get carried away by fantasies and ideas.</h5>
      <select class="chosen-select" id="q8">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 9</strong></h4>
      <h5>
        You think that everyone’s views should be respected regardless of
        whether they are supported by facts or not.
      </h5>
      <select class="chosen-select" id="q9">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h4><strong>Question 10</strong></h4>
      <h5>
        You feel more energetic after spending time with a group of people.
      </h5>
      <select class="chosen-select" id="q10">
        <option value=""></option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <br />
      <br />

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn btn-westeros btn-lg btn-block"
        id="submit"
      >
        <i class="fa fa-check-circle" aria-hidden="true"></i>
        Submit
      </button>

      <hr />
      <footer class="footer">
        <div class="container">
          <p>
            <a href="/api/friends">API Friends List</a> |
            <a
              href="https://github.com/amontalto7/FriendFinder"
              alt="Github Repo"
              >Gitub Repo</a
            >
          </p>
        </div>
      </footer>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="results-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Best Match</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h2 id="match-name"></h2>
            <img
              id="match-img"
              src="http://mantherapy.org/bundles/gritman/images/Dr_Rich_armchair.png?v21"
              alt="image"
              style="width: 200px"
            />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>

    <script type="text/javascript">
      // Chosen CSS
      var config = {
        ".chosen-select": {},
        ".chosen-select-deselect": {
          allow_single_deselect: true,
        },
        ".chosen-select-no-single": {
          disable_search_threshold: 10,
        },
        ".chosen-select-no-results": {
          no_results_text: "Oops, nothing found!",
        },
        ".chosen-select-width": {
          width: "95%",
        },
      };

      for (var selector in config) {
        $(selector).chosen(config[selector]);
      }

      // Capture the form inputs
      $("#submit").on("click", function (event) {
        event.preventDefault();

        // Form validation
        function validateForm() {
          var isValid = true;
          $(".form-control").each(function () {
            if ($(this).val() === "") {
              isValid = false;
            }
          });

          $(".chosen-select").each(function () {
            if ($(this).val() === "") {
              isValid = false;
            }
          });
          return isValid;
        }

        // If all required fields are filled
        if (validateForm()) {
          // Create an object for the user"s data
          var userData = {
            name: $("#name").val(),
            photo: $("#photo").val(),
            scores: [
              $("#q1").val(),
              $("#q2").val(),
              $("#q3").val(),
              $("#q4").val(),
              $("#q5").val(),
              $("#q6").val(),
              $("#q7").val(),
              $("#q8").val(),
              $("#q9").val(),
              $("#q10").val(),
            ],
          };

          // AJAX post the data to the friends API.
          $.post("/api/friends", userData, function (data) {
            console.log("logging data", data);

            // Reset modal contents to ensure fresh state
            $("#match-name").text("");
            $("#match-img").attr("src", "");

            // Update with new match
            $("#match-name").text(data.name);
            $("#match-img").attr("src", data.photo);

            // Show modal explicitly
            $("#results-modal").modal("show");

            $("#name, #photo").val("");
            $(".chosen-select").val("").trigger("chosen:updated");
          });
        } else {
          alert("Please fill out all fields before submitting!");
        }
      });
    </script>
  </body>
</html>
